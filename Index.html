## Step 1: Import Required library
import pandas as pd
import matplotlib.pyplot as plt

## Step 2: Import Dataset and Load It
from surprise import Dataset
data = Dataset.load_builtin('ml-100k')

## Step 3: Create Model (SVD)
from surprise import SVD
model = SVD()

## Step 4: Split Data into Train and Test  Model Training
from surprise.model_selection import train_test_split
trainset, testset = train_test_split(data, test_size=0.2)

## Step 5: Model Training on 80%
model.fit(trainset)

## Step 6: Predict on 20%
predictions = model.test(testset)

## Step 7: Evaluate the Performance of Model
from surprise import accuracy
accuracy.rmse(predictions)

## Step 8: Generate List of Items to Predict for a User
user_id = str(196)  
item_ids = trainset.all_items()
item_raw_ids = [trainset.to_raw_iid(iid) for iid in item_ids]

## step 9: Predict Ratings for All Items 
top_preds = [(iid, model.predict(user_id, iid).est) for iid in item_raw_ids]
top_recommendations = sorted(top_preds, key=lambda x: x[1], reverse=True)[:5]
for item, rating in top_recommendations:
    print(f"Recommend item: {item}, Predicted Rating: {rating:.2f}")

## step 10: Read Movie Rating Dataset
df = "C:\\Users\\ASUS\\Desktop\\MLProject\\u.item"
movie_df = pd.read_csv(df, sep='|', encoding='latin-1', header=None, usecols=[0, 1])
movie_df.columns = ['movie_id', 'title']
movie_df.head()

## step 11: Convert movie_id to string for matching
movie_id_to_title = dict(zip(movie_df['movie_id'].astype(str), movie_df['title']))

## step 12: Print recommendations with titles
for item, rating in top_recommendations:
    title = movie_id_to_title.get(item, "Unknown Movie")
    print(f"Recommend: {title} (Movie ID: {item}) â†’ Predicted Rating: {rating:.2f}")

## step 13: Plot Histogram of Ratings
all_preds = [pred.est for pred in predictions]
plt.hist(all_preds, bins=20, color='skyblue')
plt.title('Distribution of Predicted Ratings')
plt.xlabel('Predicted Rating')
plt.ylabel('Frequency')
plt.show()
